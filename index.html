<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Hexaco Personality</title>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" type="text/css" href="css/my.css">
        <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/questions.js"></script>
    </head>
<body>
  <div id="fb-root"></div>
<!-- load js sdk --> <!-- load js sdk --> <!-- load js sdk --> <!-- load js sdk --> <!-- load js sdk --> 
  <script type="text/javascript">
    //initiates the fb login and passes your parameters 
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '1419639185022815',
        xfbml      : true,
        version    : 'v2.3'
      });

      //this had to be in the fbAsyncInit function otherwise the FB object is not recognized 
     FB.getLoginStatus(function(response) {
            //handles the callback from the response, the response is a JSON object 
            statusChangeCallback(response);
      });
    };// end of the fbAsyncInit function

    //a annonymous function with arguments that are passed below
    (function(yourDocument, scriptTag, arbritaryId){
      //yourDocument is the first argument passed below the function. in this case it is the current document object. 
      //scriptTag is the second argument passed below the function. in this case it is the string "script"
      //arbritaryId is the third argument passed below the function. in this case it is the string "facebook-jssdk"      

      //Tech: 
        //getElementByTagName returns an htmlCollection object that is populated with tag elements, the value of scriptTag determines the type of tag, elements are accessed like an array

        //creates the fbSDKjs variable and initializes the firstLinkedScript variable to the 0 element in the htmlCollection

        //if scriptTag is not a valid tag firstLinkedScript will be undefined 
        //if scriptTag is not the string "script" then it will be passed the wrong tag and not work. 
      
      //English: 
        //essentially it assigns the variable firstLinkedScript to the first script linked in the html document yourDocument
        //it also creates but does not initialize the fbSDKjs variable 
      var fbSDKjs, firstLinkedScript = yourDocument.getElementsByTagName(scriptTag)[0];

      
      //searches the variable yourDocument for an element who's id is the value of arbritaryId which in this case is ("facebook-jssdk")
      //if it finds an element with an id attribute of arbritaryId then it assumes you have already linked the sdk and returns stopping the function 
      if (yourDocument.getElementById(arbritaryId)) {return;}
        
      //creates a element of type scriptTag, which in this case is a script tag element, and assigns the id attribute of this element to be the value of the arbritaryId variable
      fbSDKjs = yourDocument.createElement(scriptTag); fbSDKjs.id = arbritaryId;

      //assigns the src attribute of the fbSDKjs scriptelement to the actual facebook sdk.js
      fbSDKjs.src = "https://connect.facebook.net/en_US/sdk.js";
      //fbSDKjs is now an empty script with a src towards the facebook sdk and an id "facebook-jssdk"
      
      //gets the parent of the firstLinkedScript element, this parent is the HEAD element. 
      //insertBefore function inserts the first argument(fbSDKjs) right before the second argument(firstLinkedScript);
      //we have to call the function from firstLinkedScript parent node because the element is inserted as a child of the node that calls the function, thus would not work if the caller was not the parent of the referenced node (second argument)
      firstLinkedScript.parentNode.insertBefore(fbSDKjs, firstLinkedScript);
    }
    //the arguments that will be passed to the annonymous function 
    (document, 'script', 'facebook-jssdk'));
  </script>

<!-- navbar --><!-- navbar --><!-- navbar --><!-- navbar -->

    <nav id="myNavbar" class="navbar navbar-default navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbarCollapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Hexaco Personality</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#" target="_blank">Home</a></li> 
                </ul>
            </div>
        </div>
    </nav>

<!-- jumbotron --><!-- jumbotron --><!-- jumbotron --><!-- jumbotron -->    

    <div class="container">
        <div class="jumbotron" style="padding-bottom:20px;">
            <h1 class = "text-center">Hexaco Based Personality Inventory</h1>
            <p class = "text-center"> We will estimate your personality charateristics based on the Hexaco framework and your answers to the questions bellow</p>            
        </div>
        
<!-- fb button -->

        <div class = "row" style="text-align: center;"> 
            <div class="grey">

<!--                <div class="fb-login-button" data-max-rows="1" data-size="xlarge" data-show-faces="false" data-auto-logout-link="false"></div>-->
                    <!--<fb:login-button data-scope="public_profile, email" data-size="xlarge" onlogin="FB.getLoginStatus();">
                    </fb:login-button>-->
                    <!--<fb:login-button>
                    </fb:login-button>-->
                    <button id ="log" onclick="checkLoginState();">Login with FaceBook!</button>
                    <button onclick="getMe();">Grab my info</button>
                    <button onclick="FBtoParse();">send Facebook info to Parse</button>

            </div>
        </div>
        <br>

<!-- Question 1 --><!-- Question 1 --><!-- Question 1 --><!-- Question 1 -->

        <div class = "row c-block" style="height:140px"> 
            <div class= "center-block b-block">
                <button class="col-sm-1 myButtonLeft" id="left" onclick="prevQuestion();"><</button>
                <div class = "center-block q-block borderb col-sm-10" id="question-container">
                    <div style="height: 80%;">
                        <p  class = "text-center" style = "font-size: x-large" id="question">I would be quite bored by a visit to an art gallery.</p> 
                    </div>
                    <div>
                        <button type="button" class="input, btn btn-danger btn-sm" value="1" onclick="loadDataIntoArray(this.value);">Strongly Disagree</button>
                        <button type="button" class="input, btn btn-warning btn-sm" value="2" onclick="loadDataIntoArray(this.value);">Disagree</button>
                        <button type="button" class="input, btn btn-default btn-sm" value="3" onclick="loadDataIntoArray(this.value);">Neither Agree Nor Disagree</button>
                        <button type="button" class="input, btn btn-success btn-sm" value="4" onclick="loadDataIntoArray(this.value);">Agree</button>      
                        <button type="button" class="input, btn btn-primary btn-sm" value="5" onclick="loadDataIntoArray(this.value);">Strongly Agree</button>
                    </div>
                </div><!-- q-block --><!-- q-block --><!-- q-block -->
                <button class="col-sm-1 myButtonRight" id="right" onclick="nextQuestion();">></button>
            </div><!-- b-block --><!-- b-block --><!-- b-block --><!-- b-block -->
        </div><!-- c-block --><!-- c-block --><!-- c-block --> <!-- c-block -->   
        

<!-- send results --><!-- send results --><!-- send results --> 

        <div class = "row" style =" padding-top: 1%; padding-bottom: 1%"> <!-- Question 100 -->
            <div class = "center-block" style = "min-width: 30%; max-width: 52.8%; text-align:center;">
                <p class = "text-center"  style = "font-size: x-large">Send your results!
                </p>       
                <button type="button" class="btn btn-primary btn-lg" onclick="sendResults();">send!</button>
            </div>
        </div>  

        <br>
        <br>

        <hr>
        <div class="row">            
            <footer class="text-center">
                <p>&copy; Copyright 2013 Tutorial Republic</p>
            </footer>            
        </div>
    </div> <!-- end container -->

<!-- js for managing questions and arrays --><!-- js for managing questions and arrays -->
    <script type="text/javascript">
    //store array and changes questions
        fixButton();
        var currQ = 0;
        var array = [];
        var result;

        //grabs the array containign the answers to the questions
        function grabArray()
        {
            return array;
        }


        //makes the button sizes match the element 
        function getInnerWidth(elem) {
            return parseFloat(window.getComputedStyle(elem).width);
        }
        function getInnerHeight(elem){
            return parseFloat(window.getComputedStyle(elem).height);
        }
        function fixButton()
        {
            var width = document.getElementById("question-container");
            var height = document.getElementById("question-container");

            // replace % value with pixels
            var width1 = getInnerWidth(width) + "px";
            var height1 = getInnerHeight(height) + "px";

            document.getElementById('left').style.height = height1;
            document.getElementById('right').style.height = height1;
        }

        //controls the question navigation 
        function nextQuestion()
        {

            if (currQ < qArray.length-1)
            {
                currQ += 1;
                //console.log("curr"+currQ);
                getQuestion();
                fixButton();
            }
        }
        function prevQuestion()
        {
            if (currQ >= 1)
            {    
                currQ -= 1;
                //console.log("curr"+currQ);
                getQuestion();
                fixButton();
            }
            else{}
        }
        function getQuestion()
        {
            document.getElementById('question').innerHTML = qArray[currQ];
        }
        function loadDataIntoArray(val){
            var parsedInt = parseInt(val);
            array[currQ] = parsedInt;
            nextQuestion()
        }
    </script>

<!-- sends data to parse --><!-- sends data to parse --><!-- sends data to parse -->
    <script type="text/javascript">
        var xhr;
        function sendResults(){
                                            //alert("We just sent your answers!");
                                        /*    var xhr = new XMLHttpRequest();
                                            xhr.open("GET", "https://api.parse.com/1/classes/trial1", true);
                                            xhr.setRequestHeader("X-Parse-Application-Id", "qpCHEHBuLw3QWfDS9ZwSRbCZMUM9fs86AMCmJXbl");
                                            xhr.setRequestHeader("X-Parse-REST-API-Key", "5scsf1TfHlVRIkMQnv1XiU9VpyQR488NtMpJJ77j");
                                            xhr.setRequestHeader("Content-Type", "application/json");
                                            xhr.send();*/
            httpParsePost();
        
        }

        function log(obj) {
            $('#response').text(JSON.stringify(obj));
        }

        //sends the data to parse 
        function httpParsePost()
        {
            var url = "https://api.parse.com/1/classes/trial1";

            xhr = new XMLHttpRequest();
            /*xhr.onreadystatechange = function(){
                if (xhr.readyState === 4 && xhr.status === 200){
                    result = JSON.parse(xhr.responseText);
                    console.log(result);

                }
                if (xhr.readyState === 4 && xhr.status === 401){
                    alert("A problem occured and we could not save your answers");
                }
            }*/

            xhr.open("POST", url, true);
            xhr.setRequestHeader("X-Parse-Application-Id", "qpCHEHBuLw3QWfDS9ZwSRbCZMUM9fs86AMCmJXbl");
            xhr.setRequestHeader("X-Parse-REST-API-Key", "5scsf1TfHlVRIkMQnv1XiU9VpyQR488NtMpJJ77j");
            xhr.setRequestHeader("Content-Type", "application/json");

            var array = grabArray();

            var data = JSON.stringify({'FB_id': me.id, 'name': me.name, "array": array});

            xhr.send(data);

            console.log(xhr.status);
            console.log(xhr.statusText);
        }

        function buildParseRequest(end){
            var url = "https://api.parse.com/1/classes/"+end;
            xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("X-Parse-Application-Id", "qpCHEHBuLw3QWfDS9ZwSRbCZMUM9fs86AMCmJXbl");
            xhr.setRequestHeader("X-Parse-REST-API-Key", "5scsf1TfHlVRIkMQnv1XiU9VpyQR488NtMpJJ77j");
            xhr.setRequestHeader("Content-Type", "application/json");

            return xhr;
        }


    </script>

    
<!-- facebook stuff -->    
<script type="text/javascript">

          var me;
          var permissions;
          var friends;
          var postsContent = [];

          //this called with the response from FB from the check login status function 
          function statusChangeCallback(response) {                                  
            // The response object is returned with a status field that lets the
            // app know the current login status of the person.
            // Full docs on the response object can be found in the documentation
            // for FB.getLoginStatus().
            if (response.status === 'connected') {
              // Logged into your app and Facebook.
              console.log("your in!");    
              $("#log").html("logout of Facebook");
              $("#log").attr("onclick", "logOut();");              
            } else if (response.status === 'not_authorized') {
              // The person is logged into Facebook, but not your app.
              console.log("log into the app!");
            } else {              
              // The person is not logged into Facebook, so we're not sure if
              // they are logged into this app or not.
              console.log("log into facebook!");                 
            }
          }

          function checkLoginState() {

            // here we call the FB.getLoginStatus function from the FB SKD.
            // this will retrieve the login status, and send the response through our statusChangeCallback() function
            FB.getLoginStatus(function(response) {                                                      
              
              // if the response is not_authorized then we launch the Login logic so that the user may give our app the 
              // appropriate permissions 

              if (response.status === "not_authorized")
              {

                FB.login(function (secondResponse){                                              
                  //we call the statusChangeCallback() function again to handle the response that the Login logic generates 
                  statusChangeCallback(secondResponse);                
                }, 
                //we pass the permissions that we request from the end user, which are the public_profile and email
                {scope:"public_profile, email, user_friends"});
              }
              else{}

              // if the response is unknown then we know that the end user is not logged into Facebook, so we launch the
              // Login logic so that the user may login to Facebook and give our app appropriate permissions they have not yet
              if (response.status === "unknown"){
                FB.login(function (secondResponse){   
                  //we call the statusChangeCallback() function again to handle the response that the Login logic generates 
                  statusChangeCallback(secondResponse);                     
                },
                //we pass the permissions that we request from the end user, which are the public_profile and email
                {scope:"public_profile, email, user_friends"});
              }             
            });

          } 

          function logOut(){
              FB.logout(function(response) {
                // Person is now logged out                
                statusChangeCallback(response);                
                $("#log").html("Login with FaceBook!");
                $("#log").attr("onclick", "checkLoginState();");
              });
          }


          function getMe(){
            FB.getLoginStatus(function (response){
                if (response.status === 'connected'){
                /*  FB.api('/me', function(response) {

                    console.log(response);
                    console.log(response.id);
                    console.log(response.email);
                    console.log(response.first_name);
                    console.log(response.gender);
                    console.log(response.last_name);
                    console.log(response.link);
                    console.log(response.locale);
                    console.log(response.name);
                    console.log(response.timezone);
                    console.log(response.updated_time);
                    console.log(response.verified);                                        

                    me = response;
                    console.log('id = ' + me.id);

                   // JSON.stringify({'id': me.id});

                    console.log('string id' + JSON.stringify({'id': me.id}));

                    //me = JSON.stringify(response);

                    console.log(me);

                    

                  });     
                  FB.api('/me/permissions', function(response) {
                    
                    permissions = response;
                    console.log(permissions);
                    console.log(permissions.data[0].permission);
                  
                  });         
                  FB.api('/me/friends', function(response) {
                    if (response && !response.error) {

                            friends = response;
                            console.log(friends);
                    }                      
                  });*/
                  FB.api('/me?fields=posts.since(04/05/2010)', function(response) {
                    if (response && !response.error) {
                            posts = response;
                            next = posts.posts.paging.next;
                            //console.log(posts);
                            //console.log(posts.posts);
                            //console.log(posts.id);
                            //console.log(posts.posts.data[0].message);
                            var messages = posts.posts.data.map(collect);                            
                            postsContent.concat(messages);
                            console.log(postsContent);
                            //console.log(messages);
                            //console.log(posts.posts.paging.next);
                            pagingPost(next, 2);
                    }                      
                  });                  
                }
            }); 
          }            

          function collect (item, index){
                var retain;
                retain = item["message"];
                return retain;
          }

          function pagingPost(nextPage, pages){

                if (pages === 0){ console.log("Finnished paging");
                                    console.log(postsContent);}
                else{
                    $.ajax({
                            url: nextPage, //the url we are going to 
                            type: "GET", // the request method
                            success: function(data){ 
                                console.log("response to page: "+pages)
                                console.log(data.data[0].message);
                                var messages = data.data.map(collect);
                                postsContent += messages;
                              //  console.log(data.data);
                             //   console.log(data.paging);
                              //  console.log(data.paging.next);
                                pagingPost(data.paging.next,pages-1);
                                
                            }//,// what we do when it succeeds 
                            //dataType: "json" // the type of data we expect back 
                    });                    
                }
          }
                



          



          function FBtoParse(){
            FB.getLoginStatus( function (response){
              if (response.status === 'connected'){
                 
                  var one = buildParseRequest('me');                              
                  var data = JSON.stringify({'FB_id':me.id, 'email': me.email, 'name': me.name, 'first_name': me.first_name, 'last_name': me.last_name, 'link': me.link, 'locale': me.locale, 'timezone': me.timezone, 'verified': me.verified });
                  console.log("oneData: " + data);                  
                  one.send(data);
                  console.log(one.status);
                  console.log(one.statusText);

                  var two = buildParseRequest('permissions');

                  data = JSON.stringify({'FB_id':me.id, 'name':me.name,'permissions':[{"permission":permissions.data[0].permission, "status": permissions.data[0].status},{"permission": permissions.data[1].permission,"status":permissions.data[1].permission},{"permission": permissions.data[2].permission,"status":permissions.data[2].permission}]});
                  console.log("twoData: " + data);
                  console.log(data);
                  two.send(data);


                  console.log(two.status);
                  console.log(two.statusText);

                  var three = buildParseRequest('friends');

                  data = JSON.stringify({'FB_id': me.id, 'name': me.name, 'data':friends.data, 'summary': friends.summary});
                  console.log("threeData: " + data);

                  three.send(data);
                  console.log(three.status);
                  console.log(three.statusText);









              }
            });
          }  

        </script>
</body>
</html>